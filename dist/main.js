!function(t){var e={};function i(s){if(e[s])return e[s].exports;var l=e[s]={i:s,l:!1,exports:{}};return t[s].call(l.exports,l,l.exports,i),l.l=!0,l.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var l in t)i.d(s,l,function(e){return t[e]}.bind(null,l));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);const s=function(t){let e=t[0];return t.length>1&&(e=t[Math.floor(Math.random()*t.length)]),e};class l{constructor({transitionSpeed:t,ballistic:e,key:i}){this.key=i,this.$el=null,this.bullets=new Map,this.transitionSpeed=t,this.ballistic={model:"auto",height:0},this.enum={ballisticModel:{FIXED:"fixed",AUTO:"auto"}},this.setBallistic(e),this.generateDom()}generateDom(){const t=document.createElement("div");t.setAttribute("class","bullet-screen"),t.style.width="100%",t.style.height="100%",t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.right=0,t.style["pointer-events"]="none",this.$el=t}setBallistic(t){let e=this.enum.ballisticModel.AUTO,i=0;if("number"==typeof t){if(t<=0)throw new Error("fixed ballistic, Height must be greater than 0");e=this.enum.ballisticModel.FIXED,i=t}else if(t&&(e=Object.values(this.enum.ballisticModel).indexOf(t.model)>-1?t.model:"auto",i=Number(t.height),i<0&&(i=0),e===this.enum.ballisticModel.FIXED&&i<=0))throw new Error("fixed ballistic, Height must be greater than 0");this.ballistic.model=e,this.ballistic.height=i}loadBullet(t){switch(this.ballistic.model){case this.enum.ballisticModel.FIXED:this.fixedLoadBullet(t);break;default:this.randomLoadBullet(t)}}randomLoadBullet(t){let e=this.findRange();if(e.length){this.$el.appendChild(t.$el);let i=t.$el.offsetHeight;if(e.forEach(t=>t[1]-=i),e=e.filter(t=>t[1]>t[0]),!e.length)return void this.unmountBullet(t);let l=s(e),n=Math.floor(Math.random()*(l[1]-l[0]))+l[0];this.mountBullet(t,{top:n})}else this.unmountBullet(t)}findRange(){let t=Array.from(this.bullets.values()).filter(t=>!t.hadLeft),e=this.$el.offsetHeight;if(!t.length)return[[0,e]];t=t.map(t=>[t.$el.offsetTop,t.$el.offsetTop+t.$el.offsetHeight]).sort((t,e)=>t[0]-e[0]);let i=[];return t.forEach((s,l)=>{0===l?i.push([0,s[0]]):i.push([t[l-1][1],s[0]]),l===t.length-1&&i.push([s[1],e])}),i}fixedLoadBullet(t){let e=this.$el.offsetHeight,i=Array.from(new Array(Math.floor(e/this.ballistic.height)));i=i.map((t,e)=>({track:e,top:e*this.ballistic.height}));let l=Array.from(this.bullets.values()).filter(t=>!t.hadLeft);if(i=i.filter(t=>!l.some(e=>e._track===t.track)),!i.length)return;let n=s(i);t._track=n.track,this.mountBullet(t,{top:n.top})}mountBullet(t,e){this.$el.appendChild(t.$el),t.admission(e,this),this.bullets.set(t.data[this.key],t)}unmountBullet(t){this.$el.removeChild(t.$el),this.bullets.delete(t.data[this.key])}destroy(){this.bullets.forEach(t=>{this.unmountBullet(t)})}}class n{constructor({data:t,render:e},i){this.$el=null,this.screen=i,this.top=0,this.left=0,this.hadLeft=!1,this.render=()=>{this.$el.innerHTML=this.data.value},this.data=t,"function"==typeof e&&(this.render=e),this.generateDom()}generateDom(){const t=document.createElement("div");t.setAttribute("class","bullet"),t.style.position="absolute",t.style["white-space"]="nowrap",this.$el=t,this.$el.appendChild(this.render.call(this,this.data))}admission({top:t},e){this.screen=e,this.top=t,this.$el.style.top=this.top+"px",this.left=e.$el.offsetWidth,this.$el.style.left=this.left+"px",this.$el.style.transition=`all ${this.screen.transitionSpeed/1e3}s linear`}updatePosition(t){if(this.$el&&this.$el.parentElement){let e=this.$el.parentElement.offsetWidth;this.left-=t,this.$el.style.left=this.left+"px",this.hadLeft||e>this.$el.offsetWidth+this.left&&(this.hadLeft=!0),this.left<-this.$el.offsetWidth&&this.screen.unmountBullet(this)}}refreshRender(){Array.from(this.$el.children).forEach(t=>t.remove()),this.$el.appendChild(this.render.call(this,this.data))}}class r{constructor(t){this.$el=null,this.$parentEl=null,this.screen=null,this.options={key:"id",speed:1,ballistic:null,el:""},this.timer,this.playing=!1,this.transitionSpeed=100,this.setOptions(t),this.init(),window.BulletScreenPlayer=this}setOptions(t){this.options=Object.assign({},this.options,t)}init(){this.generateScreen(),this.mount(this.options.el)}add(t){Array.isArray(t)||(t=[t]),t.forEach(t=>{if(!t.hasOwnProperty(this.screen.key))throw new Error("The current object has no key, key is require, please set options.key");if(!this.screen.bullets.get(t[this.screen.key])){const e=new n({data:t,render:this.options.bulletRender});console.log("----------新入仓",e),this.screen.loadBullet(e),this.play()}})}play(){this.playing||(this.playing=!0,clearInterval(this.timer),this.timer=setInterval(()=>{this.screen&&this.screen.bullets.size?this.screen.bullets.forEach(t=>{t.updatePosition(5*this.options.speed)}):this.pause()},this.transitionSpeed))}pause(){clearInterval(this.timer),this.playing=!1}stop(){this.pause(),this.screen.destroy()}generateScreen(){this.screen=new l({transitionSpeed:this.transitionSpeed,ballistic:this.options.ballistic,key:this.options.key}),this.$el=this.screen.$el}refreshRender(t){if(null!=t)return void(t=Array.isArray(t)?t:[t]).forEach(t=>{const e=this.screen.bullets.get(t);e&&e.refreshRender()});Array.from(this.screen.bullets.values()).forEach(t=>{t.refreshRender()})}mount(t){let e=null;t instanceof Element?e=t:"string"==typeof t&&document.querySelector(t)&&(e=document.querySelector(t)),e&&(this.$parentEl=e,this.$parentEl.appendChild(this.$el))}destroy(){this.stop(),this.$parentEl&&(this.$parentEl.removeChild(this.$el),this.$el=null,this.$parentEl=null)}}window.BulletScreen=r;e.default=r}]);